<!DOCTYPE html>
<html>
<head>
   <title>501 Craps - alpha</title>
   <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
   <meta charset="UTF-8" />
   <link rel="stylesheet" type="text/css" href="/css/styles.css"/>
   <script type="text/javascript" src="/js/external/three.min.r55.js"></script>
   <script type="text/javascript" src="/js/external/stats.js"></script>
   <script type="text/javascript" src="/js/external/physi.r55.js"></script>
   <script type="text/javascript" src="/js/external/dat.gui.min.js"></script>
   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
   <script type="text/javascript" src="/js/betseval.js"></script>
   <script type="text/javascript" src="/js/boardclick.js"></script>
   <script type="text/javascript" src="/js/boardhover.js"></script>
   <script type="text/javascript" src="/js/diceroller.js"></script>
   <script src="/socket.io/socket.io.js"></script>
   <script type="text/javascript">

   Physijs.scripts.worker = '/js/external/physijs_worker.js';
   window.onload = function() {
      //get query variables from url querystring
      var vars = [], hash;
      var q = document.URL.split('?')[1];
         if (q != undefined) {
            q = q.split('&');
            for (var i = 0; i < q.length; i++) {
               hash = q[i].split('=');
               vars.push(hash[1]);
               vars[hash[0]] = hash[1];
            }
      }

      Roller.init();

      var socket = io.connect('http://localhost:3000');
      //var socket = io.connect('http://craps.ngrok.com/');
      //var socket = io.connect('http://craps501.herokuapp.com/');

      var screenName, funds;


      $.get('http://casino.curtiswendel.me:3000/api/getUser/'+vars['id'], function(data) {
         console.log(data);
         screenName = data.screenName;
         funds = data.balance;
         socket.emit('joinTable', {tableNumber: vars['t'], name: data.screenName, funds: data.balance});
      });

      socket.on('joinFailure', function(data) {
         alert('Table Full - redirecting back to lobby');
         window.location='http://localhost:3000/lobby';
      });

      /* socket.io events */

      socket.on('roll', function (data) {
         console.log(data);
         Roller.roll();
      });

      socket.on('playerList', function (data) {
         console.log(data.players);
         $('#players').empty();
         $.each(data.players, function(i, player) {
            $('#players').append('<div class="player" id="player'+i+'">'
                                +   '<h2>'+player.name+'</h2>'
                                +   '<h3>'+player.funds+'</h3>'
                                +   '<img id="picture2" src="http://placehold.it/350x150"></img>'
                                +'</div>');
         });
      });


      /* jQuery events */

      $('#rollButton').click(function() {
         Roller.roll();
      });

      $('#leaveGame').click(function() {
         socket.emit('leaveTable', {tableNumber: vars['t'], name: screenName});
         window.location = "http://localhost:3000/lobby";
      });

      $(window).bind('beforeunload', function() {
         $('#game, #viewport, #players').hide();
         socket.emit('leaveTable', {tableNumber: vars['t'], name: screenName});
         return "Are you sure?";
      });
   }

   </script>
</head>
<body>
   <button id="leaveGame">Leave Game</button>
   <div id="game" style="display: inline-block; float:left; background-color: gray; height:400px; width:25%;">
      <h1>Click Roll Below:</h1>
      <button id="rollButton">Roll</button><br>
   </div>
   <div id="viewport" style="display: inline-block; float:left; width: 50%;"></div>
   <div id="game" style="display: inline-block; background-color: gray; width:25%; height:400px; float:left;">
      <div id="total"></div>
      <div id="rollVal"></div>
      <div id="currGameState">
      </div>
   </div>
   <div id="gameBoard">
      <div id="passLineVert" onclick="passLineClick()"></div>
      <div id="dontPassBarVert" onclick="dontPassBarClick()"></div>
            <div id="dontComeBar"></div>
               <div class="place" id="placeFour" onclick="placeFourClick()"></div>
               <div class="place" id="placeFive" onclick="placeFiveClick()"></div>
               <div class="place" id="placeSix" onclick="placeSixClick()"></div>
               <div class="place" id="placeEight" onclick="placeEightClick()"></div>
               <div class="place" id="placeNine" onclick="placeNineClick()"></div>
               <div class="place" id="placeTen" onclick="placeTenClick()"></div>
               <div class="point" id="pointFour"></div>
               <div class="point" id="pointFive"></div>
               <div class="point" id="pointSix"></div>
               <div class="point" id="pointEight"></div>
               <div class="point" id="pointNine"></div>
               <div class="point" id="pointTen"></div>
         <div id="come"></div>
         <div id="field" onclick="fieldClick()"></div>
         <div id="dontPassBarHori" onclick="dontPassBarClick()"></div>
         <div id="passLineHori" onclick="passLineClick()"></div>
      <div id="passOdds" onclick="passOddsClick()"></div>
      <div id="anySeven" onclick="anySevenClick()"></div>
      <div id="hardWaySix" onclick="hardWaySixClick()"></div>
      <div id="hardWayTen" onclick="hardWayTenClick()"></div>
      <div id="hardWayEight" onclick="hardWayEightClick()"></div>
      <div id="hardWayFour" onclick="hardWayFourClick()"></div>
      <div id="dontPassOdds" onclick="dontPassOddsClick()"></div>
      <div id="aceDeuce" onclick="aceDeuceClick()"></div>
      <div id="snakeEyes" onclick="snakeEyesClick()"></div>
      <div id="boxcars" onclick="boxcarsClick()"></div>
      <div id="yoLeft" onclick="yoLeftClick()"></div>
      <div id="yoRight" onclick="yoRightClick()"></div>
      <div id="anyCraps" onclick="anyCrapsClick()"></div>
      <div id="message"></div>
   </div>
   <div id="players">
      <div class="player" id="player0">
         <h2 id="name0">User 0</h2>
         <h3 id="funds0">Fund: 0</h3>
         <img id="picture0" src="http://placehold.it/350x150"></img>
      </div>
   </div>
</body>
</html>